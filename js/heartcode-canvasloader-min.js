(function(window,document){'use strict';var CanvasLoader=function(id){this.initialize(id);},p=CanvasLoader.prototype,shapes=["circle","square","rectangle","roundedRectangle"],colorReg=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/;p.initialize=function(id){try{if(document.getElementById(id)!==undefined){this.container=document.getElementById(id);}else{this.container=document.body;}}catch(error){this.container=document.body;}this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.id="CanvasLoader";this.container.appendChild(this.canvas);this.canvas.width=this.canvas.height=this.diameter;this.cacheCanvas=document.createElement("canvas");document.body.appendChild(this.cacheCanvas);this.cacheContext=this.cacheCanvas.getContext("2d");this.cacheCanvas.width=this.cacheCanvas.height=this.diameter;this.cacheCanvas.style.display="none";this.setColor(this.color);p.ready=true;this.draw();this.start();};p.container=null;p.canvas=null;p.context=null;p.cacheCanvas=null;p.cacheContext=null;p.running=false;p.ready=false;p.timer=null;p.activeId=0;p.diameter=40;p.setDiameter=function(diameter){if(!isNaN(diameter)){this.diameter=Math.round(Math.abs(diameter));this.redraw();}};p.getDiameter=function(){return this.diameter;};p.colorRGB=null;p.color="#000000";p.setColor=function(color){this.color=colorReg.test(color)?color:"#000000";this.colorRGB=this.getRGB(this.color);this.redraw();};p.getColor=function(){return this.color;};p.shape=shapes[0];p.setShape=function(shape){var i=0;while(i<shapes.length){if(shape===shapes[i]){this.shape=shape;this.redraw();break;}i+=1;}};p.getShape=function(){return this.shape;};p.density=40;p.setDensity=function(density){if(!isNaN(density)){this.density=Math.round(Math.abs(density));this.redraw();}};p.getDensity=function(){return this.density;};p.range=1.3;p.setRange=function(range){if(!isNaN(range)){this.range=Math.abs(range);this.redraw();}};p.getRange=function(){return this.range;};p.scaling=false;p.setScaling=function(scaling){if(typeof(scaling)==="boolean"){this.scaling=scaling;this.redraw();}};p.getScaling=function(){return this.scaling;};p.fading=true;p.setFading=function(fading){if(typeof fading==="boolean"){this.fading=fading;this.redraw();}};p.getFading=function(){return this.fading;};p.speed=2;p.setSpeed=function(speed){if(!isNaN(speed)&&Math.abs(speed)>0){this.speed=Math.round(Math.abs(speed));this.reset();}};p.getSpeed=function(){return this.speed;};p.fps=24;p.setFPS=function(fps){if(!isNaN(fps)){this.fps=Math.round(Math.abs(fps));this.reset();}};p.getFPS=function(){return this.fps;};p.getRGB=function(color){var hexObject={};color=color.charAt(0)==="#"?color.substring(1,7):color;hexObject.r=parseInt(color.substring(0,2),16);hexObject.g=parseInt(color.substring(2,4),16);hexObject.b=parseInt(color.substring(4,6),16);return hexObject;};p.draw=function(){var i=0,size=this.diameter*0.07,radians,radius,w,h,x,y,angle,minBitMod,animBits=Math.round(this.density*this.range),bitMod;this.cacheContext.clearRect(0,0,this.cacheCanvas.width,this.cacheCanvas.height);this.canvas.width=this.canvas.height=this.cacheCanvas.width=this.cacheCanvas.height=this.diameter;switch(this.shape){case shapes[0]:minBitMod=0.1;while(i<this.density){if(i<=animBits){bitMod=1-((1-minBitMod)/animBits*i);}else{bitMod=minBitMod;}radians=(this.density-i)*((Math.PI*2)/this.density);x=this.canvas.width*0.5+Math.cos(radians)*(this.diameter*0.45-size)-this.canvas.width*0.5;y=this.canvas.height*0.5+Math.sin(radians)*(this.diameter*0.45-size)-this.canvas.height*0.5;this.cacheContext.beginPath();if(this.fading){this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+bitMod.toString()+")";}else{this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)";}if(this.scaling){this.cacheContext.arc(this.diameter*0.5+x,this.diameter*0.5+y,size*bitMod,0,Math.PI*2,false);}else{this.cacheContext.arc(this.diameter*0.5+x,this.diameter*0.5+y,size,0,Math.PI*2,false);}this.cacheContext.closePath();this.cacheContext.fill();i+=1;}break;case shapes[1]:size=this.canvas.width*0.12;minBitMod=0.1;while(i<this.density){if(i<=animBits){bitMod=1-((1-minBitMod)/animBits*i);}else{bitMod=minBitMod;}angle=360-360/this.density*i;radians=angle/180*Math.PI;x=Math.cos(radians)*size*3+this.cacheCanvas.width*0.5;y=Math.sin(radians)*size*3+this.cacheCanvas.height*0.5;this.cacheContext.save();this.cacheContext.translate(x,y);this.cacheContext.rotate(radians);this.cacheContext.translate(-x,-y);this.cacheContext.beginPath();if(this.fading){this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+bitMod.toString()+")";}else{this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)";}this.cacheContext.fillRect(x,y-size*0.5,size,size);this.cacheContext.closePath();this.cacheContext.fill();this.cacheContext.restore();i+=1;}break;case shapes[2]:w=this.cacheCanvas.width*0.24;h=w*0.35;minBitMod=0.1;while(i<this.density){if(i<=animBits){bitMod=1-((1-minBitMod)/animBits*i);}else{bitMod=minBitMod;}angle=360-360/this.density*i;radians=angle/180*Math.PI;x=Math.cos(radians)*(h+(this.cacheCanvas.height-h)*0.13)+this.cacheCanvas.width*0.5;y=Math.sin(radians)*(h+(this.cacheCanvas.height-h)*0.13)+this.cacheCanvas.height*0.5;this.cacheContext.save();this.cacheContext.translate(x,y);this.cacheContext.rotate(radians);this.cacheContext.translate(-x,-y);this.cacheContext.beginPath();if(this.fading){this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+bitMod.toString()+")";}else{this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)";}this.cacheContext.fillRect(x,y-h*0.5,w,h);this.cacheContext.closePath();this.cacheContext.fill();this.cacheContext.restore();i+=1;}break;case shapes[3]:w=this.cacheCanvas.width*0.24;h=w*0.35;radius=h*0.65;minBitMod=0.1;while(i<this.density){if(i<=animBits){bitMod=1-((1-minBitMod)/animBits*i);}else{bitMod=minBitMod;}angle=360-360/this.density*i;radians=angle/180*Math.PI;x=Math.cos(radians)*(h+(this.cacheCanvas.height-h)*0.13)+this.cacheCanvas.width*0.5;y=Math.sin(radians)*(h+(this.cacheCanvas.height-h)*0.13)+this.cacheCanvas.height*0.5;this.cacheContext.save();this.cacheContext.translate(x,y);this.cacheContext.rotate(radians);this.cacheContext.translate(-x,-y);if(this.fading){this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+bitMod.toString()+")";}else{this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)";}this.cacheContext.beginPath();this.cacheContext.moveTo(x+radius,y-h*0.5);this.cacheContext.lineTo(x+w-radius,y-h*0.5);this.cacheContext.quadraticCurveTo(x+w,y-h*0.5,x+w,y-h*0.5+radius);this.cacheContext.lineTo(x+w,y-h*0.5+h-radius);this.cacheContext.quadraticCurveTo(x+w,y-h*0.5+h,x+w-radius,y-h*0.5+h);this.cacheContext.lineTo(x+radius,y-h*0.5+h);this.cacheContext.quadraticCurveTo(x,y-h*0.5+h,x,y-h*0.5+h-radius);this.cacheContext.lineTo(x,y-h*0.5+radius);this.cacheContext.quadraticCurveTo(x,y-h*0.5,x+radius,y-h*0.5);this.cacheContext.closePath();this.cacheContext.fill();this.cacheContext.restore();i+=1;}break;}this.tick(true);};p.clean=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);};p.redraw=function(){if(this.ready){this.clean();this.draw();}};p.reset=function(){if(this.running){this.stop();this.start();}};p.tick=function(initialize){var rotUnit=this.density>360?this.density/360:360/this.density;rotUnit*=this.speed;if(!initialize){this.activeId+=rotUnit;}if(this.activeId>360){this.activeId-=360;}this.context.clearRect(0,0,this.diameter,this.diameter);this.context.save();this.context.translate(this.diameter*0.5,this.diameter*0.5);this.context.rotate(Math.PI/180*this.activeId);this.context.translate(-this.diameter*0.5,-this.diameter*0.5);this.context.drawImage(this.cacheCanvas,0,0,this.diameter,this.diameter);this.context.restore();};p.start=function(){if(!this.running){this.running=true;var t=this;this.timer=self.setInterval(function(){t.tick();},Math.round(1000/this.fps));}};p.stop=function(){if(this.running){this.running=false;this.running=false;clearInterval(this.timer);this.timer=null;delete this.timer;}};p.remove=function(){if(this.running){this.stop();}this.container.removeChild(this.canvas);};window.CanvasLoader=CanvasLoader;document.CanvasLoader=CanvasLoader;}(window,document));