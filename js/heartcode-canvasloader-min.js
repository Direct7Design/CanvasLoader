(function(j){var b=function(l){this.initialize(l)},d=b.prototype,k,a=["canvas","vml"],e=["oval","spiral","square","rect","roundRect"],h=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,i=function(l,p,o){var m=document.createElement(l),q;for(q in p){m[q]=p[q]}if(typeof(o)!=="undefined"){o.appendChild(m)}return m},g=function(m,l){var o;for(o in l){m.style[o]=l[o]}return m},c=function(m,l){var o;for(o in l){m.setAttribute(o,l[o])}return m},f=function(){return !!document.createElement("canvas").getContext};d.initialize=function(q,o){try{if(document.getElementById(q)!==undefined){this.mother=document.getElementById(q)}else{this.mother=document.body}}catch(m){this.mother=document.body}o=typeof(o)!=="undefined"?o:"canvasLoader";this.cont=g(i("div",{id:o},this.mother),{border:"1px solid #ff0000",position:"absolute"});if(f()){k=a[0];this.canvas=i("canvas",{},this.cont);this.context=this.canvas.getContext("2d");this.cacheCanvas=g(i("canvas",{},this.cont),{display:"none"});this.cacheContext=this.cacheCanvas.getContext("2d")}else{k=a[1];if(typeof(b.vmlSheet)==="undefined"){document.getElementsByTagName("head")[0].appendChild(i("style"));b.vmlSheet=document.styleSheets[document.styleSheets.length-1];var l=["group","oval","roundrect","fill"],p;for(p in l){b.vmlSheet.addRule(l[p],"behavior:url(#default#VML); position:absolute;")}}this.vml=i("group",{},this.cont)}this.setColor(this.color);d.ready=true;this.draw();this.show()};d.container={};d.canvas={};d.context={};d.cacheCanvas={};d.cacheContext={};d.running=false;d.ready=false;d.timer={};d.activeId=0;d.diameter=40;d.setDiameter=function(l){this.diameter=Math.round(Math.abs(l));this.redraw()};d.getDiameter=function(){return this.diameter};d.colorRGB={};d.color="#000000";d.setColor=function(l){this.color=h.test(l)?l:"#000000";this.colorRGB=this.getRGB(this.color);this.redraw()};d.getColor=function(){return this.color};d.shape=e[0];d.setShape=function(l){var m;for(m in e){if(l===e[m]){this.shape=l;this.redraw();break}}};d.getShape=function(){return this.shape};d.density=40;d.setDensity=function(l){this.density=Math.round(Math.abs(l));this.redraw()};d.getDensity=function(){return this.density};d.range=1.3;d.setRange=function(l){this.range=Math.abs(l);this.redraw()};d.getRange=function(){return this.range};d.fading=true;d.setFading=function(l){this.fading=l;this.redraw()};d.getFading=function(){return this.fading};d.speed=2;d.setSpeed=function(l){this.speed=Math.round(Math.abs(l));this.reset()};d.getSpeed=function(){return this.speed};d.fps=24;d.setFPS=function(l){this.fps=Math.round(Math.abs(l));this.reset()};d.getFPS=function(){return this.fps};d.getRGB=function(l){l=l.charAt(0)==="#"?l.substring(1,7):l;return{r:parseInt(l.substring(0,2),16),g:parseInt(l.substring(2,4),16),b:parseInt(l.substring(4,6),16)}};d.draw=function(){var u=0,t,q,v,p,o,B,F,l,D=Math.round(this.density*this.range),m,G=0,r,z,E,A,C=1000,n=0;if(k===a[0]){this.cacheContext.clearRect(0,0,this.cacheCanvas.width,this.cacheCanvas.height);c(this.canvas,{width:this.diameter,height:this.diameter});c(this.cacheCanvas,{width:this.diameter,height:this.diameter});while(u<this.density){m=u<=D?1-((1-G)/D*u):m=G;B=360-360/this.density*u;F=B/180*Math.PI;this.cacheContext.save();if(this.fading){this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+m.toString()+")"}else{this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}switch(this.shape){case e[0]:case e[1]:t=this.diameter*0.07;p=this.canvas.width*0.5+Math.cos(F)*(this.diameter*0.5-t)-this.canvas.width*0.5;o=this.canvas.height*0.5+Math.sin(F)*(this.diameter*0.5-t)-this.canvas.height*0.5;this.cacheContext.beginPath();if(this.shape===e[1]){this.cacheContext.arc(this.diameter*0.5+p,this.diameter*0.5+o,t*m,0,Math.PI*2,false)}else{this.cacheContext.arc(this.diameter*0.5+p,this.diameter*0.5+o,t,0,Math.PI*2,false)}break;case e[2]:t=this.diameter*0.12;p=Math.cos(F)*(this.cacheCanvas.width*0.5-t)+this.cacheCanvas.width*0.5;o=Math.sin(F)*(this.cacheCanvas.width*0.5-t)+this.cacheCanvas.height*0.5;this.cacheContext.translate(p,o);this.cacheContext.rotate(F);this.cacheContext.translate(-p,-o);this.cacheContext.beginPath();this.cacheContext.fillRect(p,o-t*0.5,t,t);break;case e[3]:q=t=this.diameter*0.3;v=q*0.27;p=Math.cos(F)*(v+(this.cacheCanvas.height-v)*0.13)+this.cacheCanvas.width*0.5;o=Math.sin(F)*(v+(this.cacheCanvas.height-v)*0.13)+this.cacheCanvas.height*0.5;this.cacheContext.translate(p,o);this.cacheContext.rotate(F);this.cacheContext.translate(-p,-o);this.cacheContext.beginPath();this.cacheContext.fillRect(p,o-v*0.5,q,v);break;case e[4]:q=t=this.diameter*0.3;v=q*0.27;l=v*0.56;p=Math.cos(F)*(v+(this.cacheCanvas.height-v)*0.13)+this.cacheCanvas.width*0.5;o=Math.sin(F)*(v+(this.cacheCanvas.height-v)*0.13)+this.cacheCanvas.height*0.5;this.cacheContext.translate(p,o);this.cacheContext.rotate(F);this.cacheContext.translate(-p,-o);this.cacheContext.beginPath();this.cacheContext.moveTo(p+l,o-v*0.5);this.cacheContext.lineTo(p+q-l,o-v*0.5);this.cacheContext.quadraticCurveTo(p+q,o-v*0.5,p+q,o-v*0.5+l);this.cacheContext.lineTo(p+q,o-v*0.5+v-l);this.cacheContext.quadraticCurveTo(p+q,o-v*0.5+v,p+q-l,o-v*0.5+v);this.cacheContext.lineTo(p+l,o-v*0.5+v);this.cacheContext.quadraticCurveTo(p,o-v*0.5+v,p,o-v*0.5+v-l);this.cacheContext.lineTo(p,o-v*0.5+l);this.cacheContext.quadraticCurveTo(p,o-v*0.5,p+l,o-v*0.5);break}this.cacheContext.closePath();this.cacheContext.fill();this.cacheContext.restore();++u}}else{g(this.cont,{width:this.diameter,height:this.diameter});g(this.vml,{width:this.diameter,height:this.diameter});switch(this.shape){case e[0]:case e[1]:E="oval";t=C*0.14;break;case e[2]:E="roundrect";t=C*0.12;break;case e[3]:case e[4]:E="roundrect";t=C*0.3;break}q=v=t;p=C*0.5-v;o=-v*0.5;while(u<this.density){m=u<=D?1-((1-G)/D*u):m=G;B=270-360/this.density*u;switch(this.shape){case e[1]:q=v=t*m;p=C*0.5-t*0.5-t*m*0.5;o=(t-t*m)*0.5;break;case e[3]:case e[4]:q=t*0.95;v=q*0.28;p=C*0.5-q;o=-v*0.5;n=this.shape===e[4]?0.6:0;break}z=c(g(i("group",{},this.vml),{width:C,height:C,rotation:B}),{coordsize:C+","+C,coordorigin:-C*0.5+","+(-C*0.5)});r=g(i(E,{stroked:false,arcSize:n},z),{width:q,height:v,top:o,left:p});A=i("fill",{color:this.color,opacity:m},r);++u}}this.tick(true)};d.clean=function(){if(k===a[0]){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}else{if(this.vml.hasChildNodes()){while(this.vml.childNodes.length>=1){this.vml.removeChild(this.vml.firstChild)}}}};d.redraw=function(){if(this.ready){this.clean();this.draw()}};d.reset=function(){if(typeof(this.timer)==="number"){this.hide();this.show()}};d.tick=function(l){var m=this.density>360?this.density/360:360/this.density;m*=this.speed;if(!l){this.activeId+=m}if(this.activeId>=360){this.activeId-=360}if(k===a[0]){this.context.clearRect(0,0,this.diameter,this.diameter);this.context.save();this.context.translate(this.diameter*0.5,this.diameter*0.5);this.context.rotate(Math.PI/180*this.activeId);this.context.translate(-this.diameter*0.5,-this.diameter*0.5);this.context.drawImage(this.cacheCanvas,0,0,this.diameter,this.diameter);this.context.restore()}else{this.vml.style.rotation=this.activeId}};d.show=function(){if(typeof(this.timer)!=="number"){var l=this;this.timer=self.setInterval(function(){l.tick()},Math.round(1000/this.fps));g(this.cont,{display:"block"})}};d.hide=function(){if(typeof(this.timer)==="number"){clearInterval(this.timer);delete this.timer;g(this.cont,{display:"none"})}};d.kill=function(){if(typeof(this.timer)==="number"){this.hide()}if(k===a[0]){this.cont.removeChild(this.canvas);this.cont.removeChild(this.cacheCanvas)}else{this.cont.removeChild(this.vml)}var l;for(l in this){delete this[l]}};j.CanvasLoader=b}(window));