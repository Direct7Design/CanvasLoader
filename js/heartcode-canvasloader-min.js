(function(a){"use strict";var b=function(a){this.initialize(a)},c=b.prototype,d,e=["canvas","vml"],f=["oval","spiral","square","rect","roundRect"],g=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,h=function(a,b,c){var d=document.createElement(a),e;for(e in b)d[e]=b[e];return typeof c!="undefined"&&c.appendChild(d),d},i=function(a,b){var c;for(c in b)a.style[c]=b[c];return a},j=function(a,b){var c;for(c in b)a.setAttribute(c,b[c]);return a},k=function(){return!!document.createElement("canvas").getContext};c.initialize=function(a,f){try{document.getElementById(a)!==undefined?this.mother=document.getElementById(a):this.mother=document.body}catch(g){this.mother=document.body}f=typeof f!="undefined"?f:"canvasLoader",this.cont=i(h("div",{id:f},this.mother),{border:"1px solid #ff0000",position:"absolute"});if(k())d=e[0],this.canvas=h("canvas",{},this.cont),this.context=this.canvas.getContext("2d"),this.cacheCanvas=i(h("canvas",{},this.cont),{display:"none"}),this.cacheContext=this.cacheCanvas.getContext("2d");else{d=e[1];if(typeof b.vmlSheet=="undefined"){document.getElementsByTagName("head")[0].appendChild(h("style")),b.vmlSheet=document.styleSheets[document.styleSheets.length-1];var j=["group","shape","oval","rect","roundrect","fill","stroke","shadow"],l;for(l in j)b.vmlSheet.addRule(j[l],"behavior:url(#default#VML);  position:absolute; antialias:true; margin:0; padding:0; border:none; left:0; top:0;")}this.vml=h("group",{},this.cont)}this.setColor(this.color),c.ready=!0,this.draw(),this.show()},c.container={},c.canvas={},c.context={},c.cacheCanvas={},c.cacheContext={},c.running=!1,c.ready=!1,c.timer={},c.activeId=0,c.diameter=40,c.setDiameter=function(a){this.diameter=Math.round(Math.abs(a)),this.redraw()},c.getDiameter=function(){return this.diameter},c.colorRGB={},c.color="#000000",c.setColor=function(a){this.color=g.test(a)?a:"#000000",this.colorRGB=this.getRGB(this.color),this.redraw()},c.getColor=function(){return this.color},c.shape=f[0],c.setShape=function(a){var b;for(b in f)if(a===f[b]){this.shape=a,this.redraw();break}},c.getShape=function(){return this.shape},c.density=40,c.setDensity=function(a){this.density=Math.round(Math.abs(a)),this.redraw()},c.getDensity=function(){return this.density},c.range=1.3,c.setRange=function(a){this.range=Math.abs(a),this.redraw()},c.getRange=function(){return this.range},c.fading=!0,c.setFading=function(a){this.fading=a,this.redraw()},c.getFading=function(){return this.fading},c.speed=2,c.setSpeed=function(a){this.speed=Math.round(Math.abs(a)),this.reset()},c.getSpeed=function(){return this.speed},c.fps=24,c.setFPS=function(a){this.fps=Math.round(Math.abs(a)),this.reset()},c.getFPS=function(){return this.fps},c.getRGB=function(a){return a=a.charAt(0)==="#"?a.substring(1,7):a,{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},c.draw=function(){var a=0,b,c,g,k,l,m,n,o,p=Math.round(this.density*this.range),q,r=0,s,t,u,v;if(d===e[0]){this.cacheContext.clearRect(0,0,this.cacheCanvas.width,this.cacheCanvas.height),j(this.canvas,{width:this.diameter,height:this.diameter}),j(this.cacheCanvas,{width:this.diameter,height:this.diameter});while(a<this.density){q=a<=p?1-(1-r)/p*a:q=r,m=360-360/this.density*a,n=m/180*Math.PI,this.cacheContext.save(),this.fading?this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+q.toString()+")":this.cacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)";switch(this.shape){case f[0]:case f[1]:b=this.diameter*.07,k=this.canvas.width*.5+Math.cos(n)*(this.diameter*.5-b)-this.canvas.width*.5,l=this.canvas.height*.5+Math.sin(n)*(this.diameter*.5-b)-this.canvas.height*.5,this.cacheContext.beginPath(),this.shape===f[1]?this.cacheContext.arc(this.diameter*.5+k,this.diameter*.5+l,b*q,0,Math.PI*2,!1):this.cacheContext.arc(this.diameter*.5+k,this.diameter*.5+l,b,0,Math.PI*2,!1);break;case f[2]:b=this.diameter*.12,k=Math.cos(n)*b*3+this.cacheCanvas.width*.5,l=Math.sin(n)*b*3+this.cacheCanvas.height*.5,this.cacheContext.translate(k,l),this.cacheContext.rotate(n),this.cacheContext.translate(-k,-l),this.cacheContext.beginPath(),this.cacheContext.fillRect(k,l-b*.5,b,b);break;case f[3]:c=b=this.diameter*.24,g=c*.35,k=Math.cos(n)*(g+(this.cacheCanvas.height-g)*.13)+this.cacheCanvas.width*.5,l=Math.sin(n)*(g+(this.cacheCanvas.height-g)*.13)+this.cacheCanvas.height*.5,this.cacheContext.translate(k,l),this.cacheContext.rotate(n),this.cacheContext.translate(-k,-l),this.cacheContext.beginPath(),this.cacheContext.fillRect(k,l-g*.5,c,g);break;case f[4]:c=b=this.diameter*.24,g=c*.35,o=g*.55,k=Math.cos(n)*(g+(this.cacheCanvas.height-g)*.13)+this.cacheCanvas.width*.5,l=Math.sin(n)*(g+(this.cacheCanvas.height-g)*.13)+this.cacheCanvas.height*.5,this.cacheContext.translate(k,l),this.cacheContext.rotate(n),this.cacheContext.translate(-k,-l),this.cacheContext.beginPath(),this.cacheContext.moveTo(k+o,l-g*.5),this.cacheContext.lineTo(k+c-o,l-g*.5),this.cacheContext.quadraticCurveTo(k+c,l-g*.5,k+c,l-g*.5+o),this.cacheContext.lineTo(k+c,l-g*.5+g-o),this.cacheContext.quadraticCurveTo(k+c,l-g*.5+g,k+c-o,l-g*.5+g),this.cacheContext.lineTo(k+o,l-g*.5+g),this.cacheContext.quadraticCurveTo(k,l-g*.5+g,k,l-g*.5+g-o),this.cacheContext.lineTo(k,l-g*.5+o),this.cacheContext.quadraticCurveTo(k,l-g*.5,k+o,l-g*.5)}this.cacheContext.closePath(),this.cacheContext.fill(),this.cacheContext.restore(),++a}}else{i(this.cont,{width:this.diameter,height:this.diameter}),i(this.vml,{width:this.diameter,height:this.diameter,position:"relative",display:"block",background:"#ff0000",border:"1px solid #000"});switch(this.shape){case f[0]:u="oval",b=this.diameter*.14;break;case f[1]:u="rect",b=this.diameter*.12;break;case f[2]:u="rect",b=this.diameter*.24;break;case f[3]:u="roundrect",b=this.diameter*.24}while(a<this.density){q=a<=p?1-(1-r)/p*a:q=r,m=90-360/this.density*a;switch(this.shape){case f[0]:case f[1]:c=g=b,k=this.diameter*.5-b*.5+"px",l="0px";break;case f[2]:case f[3]:g=b,c=g*.35,k=this.diameter*.5-c*.5+"px",l="0px"}t=i(h("group",{},this.vml),{width:this.diameter,height:this.diameter,rotation:m+"deg"}),s=i(h(u,{stroked:!1},t),{width:c,height:g,top:l,left:k}),this.shape===f[3]&&j(s,{arcSize:"50%"}),v=h("fill",{color:this.color,opacity:q},s),++a}}this.tick(!0)},c.clean=function(){if(d===e[0])this.context.clearRect(0,0,this.canvas.width,this.canvas.height);else if(this.vml.hasChildNodes())while(this.vml.childNodes.length>=1)this.vml.removeChild(this.vml.firstChild)},c.redraw=function(){this.ready&&(this.clean(),this.draw())},c.reset=function(){typeof this.timer=="number"&&(this.hide(),this.show())},c.tick=function(a){var b=this.density>360?this.density/360:360/this.density;b*=this.speed,a||(this.activeId+=b),this.activeId>=360&&(this.activeId-=360),d===e[0]?(this.context.clearRect(0,0,this.diameter,this.diameter),this.context.save(),this.context.translate(this.diameter*.5,this.diameter*.5),this.context.rotate(Math.PI/180*this.activeId),this.context.translate(-this.diameter*.5,-this.diameter*.5),this.context.drawImage(this.cacheCanvas,0,0,this.diameter,this.diameter),this.context.restore()):this.vml.style.rotation=this.activeId},c.show=function(){if(typeof this.timer!="number"){var a=this;this.timer=self.setInterval(function(){a.tick()},Math.round(1e3/this.fps)),i(this.cont,{display:"block"})}},c.hide=function(){typeof this.timer=="number"&&(clearInterval(this.timer),delete this.timer,i(this.cont,{display:"none"}))},c.kill=function(){typeof this.timer=="number"&&this.hide(),d===e[0]?(this.cont.removeChild(this.canvas),this.cont.removeChild(this.cacheCanvas)):this.cont.removeChild(this.vml);var a;for(a in this)delete this[a]},a.CanvasLoader=b})(window)