<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>Canvas Test - Centered rotation</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="language" content="en" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
</head>
<body>
	<canvas id="canvas" width="300" height="300" style="border:1px solid #ff0000;"></canvas>
	<script type="text/javascript">
		var canvas = document.getElementById("canvas");
		var context = canvas.getContext("2d");
		var density = 12;
		context.fillStyle = "rgba(255, 0, 0, 0.2)";
		
		// Rotate the graphics
		function drawGraphics() {
			
			context.clearRect(0, 0, context.width, context.height);
		
			var i = 0;
			var w = canvas.width * .18;
			var h = w*0.4;
			var radians;
			var x, y, angle;
			while(i<this.density)
			{
				angle = 360/density*i;
				radians = (angle)/180*Math.PI;
				x = Math.cos(radians) * w*0.9 + canvas.width*0.5;
				y = Math.sin(radians) * w*0.9 + canvas.height*0.5;
				
				context.save();
				context.translate(x, y);
				context.rotate(radians);
				context.translate(-x, -y);
				context.beginPath();
				context.fillRect(x,y-h*.5,w,h);
				context.closePath();
				context.fill();
				context.restore();
				
				++i;
			}
			
			context.fillRect(5, 5, canvas.width-10, canvas.height-10);
		};
		
		drawGraphics();
		
		// Rotate the graphics
		function rotateGraphics(percent) {
			var radians = (360*percent)/180*Math.PI;	
			var x = Math.round(canvas.width*.5 + Math.cos(radians) * (canvas.width*.45) - canvas.height*.5);
			var y = Math.round(canvas.height*.5 + Math.sin(radians) * (canvas.height*.45) - canvas.height*.5);
			context.save();
			context.clearRect(0, 0, canvas.width, canvas.height);
			context.translate(canvas.width*0.5, canvas.height*0.5);
			context.rotate(radians);
			context.translate(-canvas.width*0.5, -canvas.height*0.5);
			drawGraphics();
			context.restore();
		};
		
		// Handle the mouse move event
		canvas.onmousemove = function(event){
			var offsetX = 8;
			var percent = Math.floor((event.x - offsetX) / canvas.width * 100) / 100;
			rotateGraphics(percent);
		};
	</script>
</body>
</html>